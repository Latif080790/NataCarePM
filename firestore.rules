rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // TEMPORARY RELAXED RULES FOR DEBUGGING
    // These rules allow more permissive access to diagnose connection issues
    
    // Helper function
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Users - allow authenticated users to read their own data
    match /users/{userId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() && request.auth.uid == userId;
    }
    
    // Projects - allow authenticated users
    match /projects/{projectId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
      
      // Project subcollections
      match /{subcollection}/{document=**} {
        allow read, write: if isAuthenticated();
      }
    }
    
    // Workspaces
    match /workspaces/{workspaceId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Config
    match /config/{configId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // AHSP Data
    match /ahspData/{itemId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Workers
    match /workers/{workerId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Notifications
    match /notifications/{notificationId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Vendors - allow authenticated users
    match /vendors/{vendorId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Vendor Evaluations
    match /vendor_evaluations/{evaluationId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Vendor Blacklist
    match /vendor_blacklist/{blacklistId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Monitoring/Logs - allow all authenticated for debugging
    match /systemMetrics/{metricId} {
      allow read, write: if isAuthenticated();
    }
    
    match /errorLogs/{errorId} {
      allow read, write: if isAuthenticated();
    }
    
    match /userActivities/{activityId} {
      allow read, write: if isAuthenticated();
    }
    
    match /userSessions/{sessionId} {
      allow read, write: if isAuthenticated();
    }
    
    match /performanceMetrics/{metricId} {
      allow read, write: if isAuthenticated();
    }
    
    match /userRateLimits/{userId} {
      allow read, write: if isAuthenticated();
    }
    
    // Deny all other paths
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
